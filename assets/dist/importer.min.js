"use strict";var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return void 0===obj?"undefined":_typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":void 0===obj?"undefined":_typeof2(obj)};window.awesomeSupportImporterVars=window.awesomeSupportImporterVars||{},window.awesomeSupportImporter=window.awesomeSupportImporter||{fields:{},dates:{},helpScout:{}},function($,window,document,importer,importerVars){importer.isLoading=!1;var $importerContainer,$helpDesk,$save,$importTickets,$loadingMessage,$doneMessage,initGlobalVars=function(){"object"===(void 0===importerVars?"undefined":_typeof(importerVars))&&importerVars.hasOwnProperty("ajaxErrorMessage")||(importerVars={ajaxErrorMessage:"An error occurred during the import process. Here are the error details:",hideFieldWhenNotActive:!0}),importerVars.hideFieldWhenNotActive=!!importerVars.hideFieldWhenNotActive},manageFields=function(){var selectedAPI=$helpDesk.val();if($importerContainer.attr("data-selectedapi",selectedAPI),$importerContainer.data("selectedapi",selectedAPI),"default"===selectedAPI)return importer.helpScout.hideMailboxSelect(!0),importer.fields.toReadonly(!0);!1===importer.isLoading&&($loadingMessage.removeAttr("disabled"),$loadingMessage.hide(),$doneMessage.hide()),importer.fields.show(selectedAPI,!importer.isLoading),importer.helpScout.render(selectedAPI),$importTickets.prop("disabled",!_isReadyForImport(selectedAPI))},runImporter=function(event){event.preventDefault(),importer.prepareFormForAjaxGet();var data=importer.getOptionValues();data.action="importTicketsByApi",data.security=$("#awesome-support-importer-save-nonce").val(),$.post(ajaxurl,data,function(responseMessage){importer.loadSuccessMessage(responseMessage)}).fail(function(jqXHR){importer.loadErrorMessage(jqXHR)}).always(function(){importer.resetFormAjaxDone()})};importer.prepareFormForAjaxGet=function(){$doneMessage.hide(),$loadingMessage.show(),$save.prop("disabled",!0),$importTickets.prop("disabled",!0),importer.fields.toReadonly(!1)},importer.resetFormAjaxDone=function(){var selectedApi=$helpDesk.val();$loadingMessage.hide(),importer.fields.show(selectedApi,!1),importer.helpScout.render(selectedApi),$save.prop("disabled",!1),$importTickets.prop("disabled",!1)},importer.getOptionValues=function(){var $values={};return $values[$helpDesk.attr("name")]=$helpDesk.val(),$values=importer.fields.getValues($values),$values=importer.helpScout.getValues($values),$values=importer.dates.getDates($values)},importer.loadSuccessMessage=function(responseMessage){$doneMessage.addClass("is-success").removeClass("is-error").empty().html(responseMessage).show()},importer.loadErrorMessage=function(jqXHR){$doneMessage.removeClass("is-success").addClass("is-error").empty().html(importerVars.ajaxErrorMessage+importer.getErrorMessage(jqXHR)).show()},importer.getErrorMessage=function(jqXHR){return jqXHR&&jqXHR.hasOwnProperty("responseJSON")&&jqXHR.responseJSON.hasOwnProperty("data")&&jqXHR.responseJSON.data.hasOwnProperty("message")?jqXHR.responseJSON.data.message:""};var _isReadyForImport=function(selectedApi){if($(".notice-error").length>0)return!1;var isReady=!0;return isReady=importer.fields.readyForImport(isReady,selectedApi),isReady=importer.helpScout.readyForImport(isReady,selectedApi)};$(function(){importer.isLoading=!0,importer.vars=awesomeSupportImporterVars,initGlobalVars(),$importerContainer=$("#awesome-support-importer"),$helpDesk=$('select[name="awesome-support-importer-help-desk"]'),$save=$("#awesome-support-import-tickets-save"),$importTickets=$("#awesome-support-import-tickets"),$loadingMessage=$("#awesome-support-importing-tickets-message"),$doneMessage=$("#awesome-support-importer-done-message"),$helpDesk.on("change",manageFields),$importTickets.on("click",runImporter),importer.dates.init(),importer.helpScout.init(),importer.fields.init($importerContainer),manageFields(),importer.isLoading=!1})}(jQuery,window,document,window.awesomeSupportImporter,awesomeSupportImporterVars),function($,window,document,importer){var $apiInputs,$invalidSubdomainMessage,fields={};fields.init=function($importerContainer){$apiInputs=$importerContainer.find("input").not('input[type="hidden"], [data-fieldtype="date"]'),$invalidSubdomainMessage=$importerContainer.find(".awesome-support-importer-invalid-subdomain"),$("#awesome-support-importer-api-subdomain").on("change",function(){_validateSubdomain($(this))})},fields.getValues=function($values){return $values=$values||{},$.each($apiInputs,function(){var $input=$(this);$values[$input.attr("name")]=$input.val()}),$values};var _hasSubstring=function(haystack,needle){return-1!==haystack.indexOf(needle)},_isInArray=function(needle,haystack){return-1!==$.inArray(needle,haystack)};fields.readyForImport=function(isReady){return $.each($apiInputs,function(){var $input=$(this);return""!==$.trim($input.val())?!0===_validateSubdomain($input)||(isReady=!1,!1):$input.attr("readonly")?void 0:(isReady=!1,!1)}),isReady},fields.toReadonly=function(clearValue){$.each($apiInputs,function(){resetApiInput($(this),clearValue,!1)})};var resetApiInput=function($input,clearValue,hideOption){$input.prop("readonly",!0),!0===clearValue&&$input.val(""),!0===hideOption&&$input.parents(".option").hide()};fields.show=function(selectedAPI,clearValue){$.each($apiInputs,function(){var $input=$(this);if(!function($input,selectedAPI){var forApi=$input.data("forapi")||"all";if(_hasSubstring(forApi,",")){var forMultipleApis=$.map(forApi.split(","),$.trim);return _isInArray(selectedAPI,forMultipleApis)}return"all"===forApi||forApi===selectedAPI}($input,selectedAPI))return resetApiInput($input,!0,importer.vars.hideFieldWhenNotActive),!0;!0===clearValue&&$input.val(""),$input.removeAttr("readonly").parents(".option").show()})};var _validateSubdomain=function($input){return"awesome-support-importer-api-subdomain"!==$input.attr("name")||(/\s/.test($input.val())?($invalidSubdomainMessage.slideDown(),!1):($invalidSubdomainMessage.is(":visible")&&$invalidSubdomainMessage.slideUp(),!0))};importer.fields=fields}(jQuery,window,document,window.awesomeSupportImporter),function($,window,document,importer){var $dateFields,dates={};dates.init=function(){$.datepicker.setDefaults({buttonImageOnly:!0,buttonImage:"calendar.gif",altFormat:"yyyy-mm-dd"}),($dateFields=$('*[data-fieldtype="date"]')).datepicker({constrainInput:!0}),$dateFields.on("keypress",function(event){event.preventDefault()})},dates.isDateField=function($field){return"date"===$field.data("fieldtype")},dates.getDates=function($values){return $values=$values||{},$.each($dateFields,function(){var $input=$(this);$values[$input.attr("name")]=$input.val()}),$values},importer.dates=dates}(jQuery,window,document,window.awesomeSupportImporter),function($,window,document,importer){var $mailboxSelect,$helpScoutMessage,$mailboxesLoadedMessage,$errorMessage,helpScout={};helpScout.init=function(){$mailboxSelect=$('select[name="awesome-support-importer-api-mailbox"]'),$helpScoutMessage=$("#awesome-support-importing-getting-mailboxes-message"),$mailboxesLoadedMessage=$(".awesome-support-importer-mailboxes-loaded"),$errorMessage=$(".awesome-support-importer-message"),$("#awesome-support-get-helpscout-mailboxes").on("click",getMailboxes)},helpScout.render=function(selectedApi){isHelpScout(selectedApi)?show():helpScout.hideMailboxSelect(!0)},helpScout.getValues=function($values){$values=$values||{};var selectedMailbox=$mailboxSelect.val();return $values[$mailboxSelect.attr("name")]=null===selectedMailbox?"":selectedMailbox,$values},helpScout.hideMessage=function(){$helpScoutMessage.hide(),$mailboxesLoadedMessage.hide(),$errorMessage.hide()},helpScout.hideMailboxSelect=function(resetOption){$mailboxSelect.parent(".option").hide(),!0===resetOption&&$mailboxSelect.val("")},helpScout.readyForImport=function(isReady,selectedApi){return!0===isReady&&isHelpScout(selectedApi)?""!==$mailboxSelect.val():isReady};var isHelpScout=function(selectedApi){return"help-scout"===selectedApi},show=function(){$mailboxSelect.parent(".option").show()},getMailboxes=function(event){if(event.preventDefault(),$("#awesome-support-importer-api-token").val()){importer.prepareFormForAjaxGet(),$helpScoutMessage.show(),$mailboxesLoadedMessage.hide(),$errorMessage.hide();var data=importer.getOptionValues();data.action="getHelpScoutMailboxes",data.security=$("#awesome-support-importer-save-nonce").val(),$.post(ajaxurl,data,function(html){$mailboxesLoadedMessage.slideDown(),console.log("got them!"),$mailboxSelect.empty().append(html).val("")}).fail(function(jqXHR){importer.loadErrorMessage(jqXHR)}).always(function(){$helpScoutMessage.hide(),importer.resetFormAjaxDone()})}};importer.helpScout=helpScout}(jQuery,window,document,window.awesomeSupportImporter);